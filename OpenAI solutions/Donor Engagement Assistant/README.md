# Donor Engagement Assistant

Donor Engagement Assistant is a customized experience for the Microsoft Dynamics 365 Fundraising and Engagement platform to allow users of the system to create targeted email communications to donors. Based on their needs, users will interact with the Microsoft Azure OpenAI Service to create a personal letter and send it to a donor.



## Apps

- Canvas App - OpenAI Letter Generator - contains the editable form that generates an email using GPT 3.5+ by connecting to Azure OpenAI

## Environment Variables

- AI Letter Generator URL – the URL of the Canvas App in the deployed environment
- Azure OpenAI Host URL – the endpoint of your Azure OpenAI instance
- Azure OpenAI Host URL – the partial URL of a deployed model, e.g. “openai/deployments/gpt-turbo/”


## Web Resources

- HTML – contains the OpenAI Letter Generator inside an iFrame element so it can be displayed in a side pane within an F&E entity form rather than being embedded on the form itself.
- Javascript – opens a side pane and directs it to open the HTML file. Triggered by a button on the form command bar/ribbon (“OpenAI Letter”).
- Image – icon used for the “OpenAI Letter” command bar/ribbon button


## Tables

- Out-of-the-box tables with customizations:Campaign, Contact, Designation, Opportunity, Transaction
- Custom Tables: FundraisingInitiative – contains parameters for the email such as non-profit type and monetary amount requested, for user selection in drop-down controls in the Canvas App. ResponseTracking – contains generated email responses and a Yes/No field indicating whether the user decided to use that response, for training the model (currently not possible with gpt35-turbo)


## Custom connector for the canvas app

- Uses API key generated by your Azure OpenAI instance for authentication as a parameter in the request header. The key is named ‘api-key’
- Model type & version are included as request body parameters with defaults


## Import

1. Navigate to the Power Apps Portal
2. Click on Solutions in the left-hand navigation
3. Click on Import Solution in the top navigation bar
4. Click on browse and locate the unmanaged solution zip file on your computer
5. Follow the remaining prompts to import the solution
	
	- The solution includes an Environment Variable for the Canvas App URL. You will be prompted to enter a value. you must enter values for rsm_AzureOpenAIHostURL and rsm_AzureOpenAIBaseURL to avoid an import error. You will need to replace these URLs once you set the environment variables described in the next step


## Set Environment Variable

- The Canvas App has a unique URL (‘Web Link’) for each environment it’s deployed in. Because this varies, it must be manually stored in an Environment Variable so the calling Javascript can obtain the correct URL
	- Copy the full URL (‘Web Link’) of the OpenAI Letter Generator via the Details pane
	- Edit the AI Letter Generator URL Environment Variable. Under Current Value, add a New Value and paste the copied URL into the text field


## Developer Notes

- Find instructions on how to deploy Azure OpenAI [here](https://learn.microsoft.com/en-us/azure/cognitive-services/openai/how-to/create-resource?pivots=web-portal).


## FAQ
### Should the assistant use GPT-3.5 or GPT-4?
The app was tested with GPT-3.5 

### Can the assistant use Azure Open AI?
The app functions with both OpenAI or Azure Open AI. The repo currently uses Azure OpenAI. 
[Request access to Azure OpenAI.](https://customervoice.microsoft.com/Pages/ResponsePage.aspx?id=v4j5cvGGr0GRqy180BHbR7en2Ais5pxKtso_Pz4b1_xUOFA5Qk1UWDRBMjg0WFhPMkIzTzhKQ1dWNyQlQCN0PWcu)


